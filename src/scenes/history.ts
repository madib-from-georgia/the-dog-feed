import { Scenes } from 'telegraf';
import { BotContext } from '../types';
import { getHistoryKeyboard } from '../utils/keyboards';
import { MESSAGES, SCENES } from '../utils/constants';

export const historyScene = new Scenes.BaseScene<BotContext>(SCENES.HISTORY);

// –í—Ö–æ–¥ –≤ —Å—Ü–µ–Ω—É –∏—Å—Ç–æ—Ä–∏–∏
historyScene.enter((ctx) => {
  const message = 'üìã –ò—Å—Ç–æ—Ä–∏—è –∫–æ—Ä–º–ª–µ–Ω–∏–π\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:';
  ctx.reply(message, getHistoryKeyboard());
});

// –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
historyScene.hears(/üìÖ –°–µ–≥–æ–¥–Ω—è/, (ctx) => {
  ctx.scene.enter(SCENES.TODAY_HISTORY);
});

historyScene.hears(/üìã –í—Å–µ –∫–æ—Ä–º–ª–µ–Ω–∏—è/, (ctx) => {
  ctx.scene.enter(SCENES.FULL_HISTORY);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"
historyScene.hears(/üè† –í—ã–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω/, (ctx) => {
  ctx.scene.enter(SCENES.MAIN);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /home
historyScene.command('home', (ctx) => {
  ctx.scene.enter(SCENES.MAIN);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (–Ω–æ –Ω–µ –∫–æ–º–∞–Ω–¥, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å /)
historyScene.on('text', (ctx) => {
  const text = ctx.message.text;
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å /
  if (text.startsWith('/')) {
    return;
  }
  
  ctx.reply(
    '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.',
    getHistoryKeyboard()
  );
});
