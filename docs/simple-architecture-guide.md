# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–±–∏–ª–∞) ü§ì

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ–±–µ —Ç–∞–∫—É—é —Å—Ö–µ–º—É:

## üåç **–û–±—â–∞—è —Å—Ö–µ–º–∞: –∫—Ç–æ –∫–æ–º—É –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã**

```
–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ‚Üí TELEGRAM ‚Üí YANDEX CLOUD VM ‚Üí –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
     ‚Üì              ‚Üì           ‚Üì               ‚Üì
  –ù–∞–∂–∏–º–∞–µ—Ç        –ü–æ–ª—É—á–∞–µ—Ç   –ü–æ–ª—É—á–∞–µ—Ç        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
   –∫–Ω–æ–ø–∫—É         —Å–æ–æ–±—â–µ–Ω–∏–µ   webhook         –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
```

**‚ö†Ô∏è –ì–õ–ê–í–ù–û–ï:** Telegram **–°–ê–ú** —Å—Ç—É—á–∏—Ç—Å—è –∫ –≤–∞—à–µ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç!

---

## üîÑ **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**

### **1. Webhook —Ä–µ–∂–∏–º (PRODUCTION) - –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:**

- –í–∞—à –±–æ—Ç –≥–æ–≤–æ—Ä–∏—Ç Telegram: "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å—Ç—É—á–∏—Å—å —Å—é–¥–∞: `http://89.169.189.202/webhook`"
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É
- Telegram **–°–ê–ú** –¥–µ–ª–∞–µ—Ç HTTP POST –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- –í–∞—à —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç Telegram'—É, —á—Ç–æ –¥–µ–ª–∞—Ç—å

### **2. Polling —Ä–µ–∂–∏–º (DEVELOPMENT):**

- –í–∞—à –±–æ—Ç **–°–ê–ú** –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Telegram: "–ï—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è?"
- Telegram –æ—Ç–≤–µ—á–∞–µ—Ç: "–î–∞, –≤–æ—Ç –æ–Ω–∏" –∏–ª–∏ "–ù–µ—Ç"

---

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ VM)**

```
–ò–ù–¢–ï–†–ù–ï–¢ (–ø–æ—Ä—Ç 80/443)
       ‚Üì
   üî• FIREWALL (ufw)
       ‚Üì (—Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ—Ä—Ç 80)
   üåê NGINX (–ø–æ—Ä—Ç 80/443)
       ‚Üì (–ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ localhost:3000)
   ü§ñ NODE.JS –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (–ø–æ—Ä—Ç 3000)
       ‚Üì
   üíæ SQLITE DATABASE (—Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ)
```

---

## üì° **–ü—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—à–∞–≥–æ–≤–æ**

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤ Telegram
2. **Telegram —Å–µ—Ä–≤–µ—Ä—ã** –ø–æ–ª—É—á–∞—é—Ç —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ
3. **Telegram** –¥–µ–ª–∞–µ—Ç HTTP POST –∑–∞–ø—Ä–æ—Å –Ω–∞: `http://89.169.189.202/webhook`
4. **Yandex Cloud VM** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 80
5. **UFW Firewall** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç - –ø–æ—Ä—Ç 80 —Ä–∞–∑—Ä–µ—à–µ–Ω ‚úÖ
6. **Nginx** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ —Å–º–æ—Ç—Ä–∏—Ç –∫–æ–Ω—Ñ–∏–≥:
    ```nginx
    location /webhook {
        proxy_pass http://127.0.0.1:3000;  # –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    }
    ```
7. **Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –Ω–∞ –ø–æ—Ä—Ç—É 3000 –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
8. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ SQLite
9. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –æ—Ç–≤–µ—á–∞–µ—Ç Telegram'—É JSON'–æ–º
10. **Telegram** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üîê **–ö–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã –∏ –∑–∞—á–µ–º**

| –ü–æ—Ä—Ç     | –ö—Ç–æ —Å–ª—É—à–∞–µ—Ç | –ó–∞—á–µ–º                      | –ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è        |
| -------- | ----------- | -------------------------- | ---------------------------- |
| **22**   | SSH         | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –¢–æ–ª—å–∫–æ –≤—ã (–ø–æ –∫–ª—é—á—É)         |
| **80**   | Nginx       | HTTP webhooks –æ—Ç Telegram  | –í–µ—Å—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç                |
| **3000** | Node.js     | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞            | –¢–æ–ª—å–∫–æ localhost (127.0.0.1) |

**üí° –í–∞–∂–Ω–æ:** –ü–æ—Ä—Ç 3000 –ù–ï –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞! –ö –Ω–µ–º—É –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ Nginx –∏–∑–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞.

---

## üõ°Ô∏è **–ì–¥–µ —Å—Ç–æ—è—Ç —Ñ–∞–π—Ä–≤–æ–ª—ã –∏ –∑–∞—â–∏—Ç–∞**

1. **UFW (Uncomplicated Firewall)** –Ω–∞ VM:

    ```bash
    sudo ufw allow ssh    # –ø–æ—Ä—Ç 22
    sudo ufw allow 80     # –ø–æ—Ä—Ç 80
    # –ø–æ—Ä—Ç 3000 –ù–ï –æ—Ç–∫—Ä—ã—Ç!
    ```

2. **Yandex Cloud Security Groups** (—Å–µ—Ç–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å):
    - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—ë
    - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ

3. **Nginx Rate Limiting** (–∑–∞—â–∏—Ç–∞ –æ—Ç DDoS):
    ```nginx
    limit_req_zone $binary_remote_addr zone=webhook:10m rate=10r/s;
    ```

---

## üöÄ **–ö–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä—ã –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã**

1. **Telegram —Å–µ—Ä–≤–µ—Ä—ã** (api.telegram.org) - –ø–æ–ª—É—á–∞—é—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–í–∞—à–∞ VM –≤ Yandex Cloud** (89.169.189.202) - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhooks
3. **Nginx** (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä) - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö
4. **Node.js –ø—Ä–æ—Ü–µ—Å—Å** (–≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
5. **SQLite —Ñ–∞–π–ª** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ VM

---

## ‚ö° **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏**

–°–∫—Ä–∏–ø—Ç `deploy-yandex.sh` –¥–µ–ª–∞–µ—Ç:

1. **–°–æ–∑–¥–∞–µ—Ç VM** –≤ Yandex Cloud (2 CPU, 2GB RAM)
2. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç** Node.js, Git, PM2
3. **–ö–æ–ø–∏—Ä—É–µ—Ç** –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
5. **–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç—ã** –≤ firewall (22, 80)
6. **–ó–∞–ø—É—Å–∫–∞–µ—Ç** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2
7. **–ì–æ–≤–æ—Ä–∏—Ç Telegram'—É** –∞–¥—Ä–µ—Å webhook'–∞

---

## üîß **–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run status:yandex

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
npm run logs:yandex

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
pm2 restart dog-feeding-bot
```

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:** Telegram —Å—Ç—É—á–∏—Ç—Å—è –∫ –≤–∞—à–µ–π –º–∞—à–∏–Ω–∫–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, Nginx –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç, —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é! üêï

## üîÑ **–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö**

```mermaid
sequenceDiagram
    participant U as üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant T as üì± Telegram
    participant I as üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
    participant F as üî• Firewall (UFW)
    participant N as üåê Nginx
    participant A as ü§ñ Node.js App
    participant D as üíæ SQLite DB

    U->>T: –ù–∞–∂–∏–º–∞–µ—Ç "–Ø –ø–æ–∫–æ—Ä–º–∏–ª"
    T->>I: POST http://89.169.189.202/webhook
    I->>F: –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 80
    F->>N: –ü–æ—Ä—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω ‚úÖ
    N->>A: proxy_pass localhost:3000
    A->>D: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä–º–ª–µ–Ω–∏–µ
    D->>A: OK
    A->>N: JSON –æ—Ç–≤–µ—Ç
    N->>F: –û—Ç–≤–µ—Ç
    F->>I: –û—Ç–≤–µ—Ç
    I->>T: HTTP 200 + JSON
    T->>U: "‚úÖ –ó–∞–ø–∏—Å–∞–ª! –°–ª–µ–¥—É—é—â–µ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ –≤ 15:30"
```
