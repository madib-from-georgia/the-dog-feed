# üîí –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –æ—à–∏–±–æ–∫ SSL

## ‚ùå –¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞: "Timeout during connect"

```
Domain: yourdomain.com
Type: connection
Detail: IP: Fetching http://yourdomain.com/.well-known/acme-challenge/XXX: Timeout during connect (likely firewall problem)
```

## üîß –ü–æ—à–∞–≥–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
./scripts/maintenance/diagnose-connectivity.sh yourdomain.com
```

### 2. üî• –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ Yandex Cloud Security Groups

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!** –í Yandex Cloud Console:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Compute Cloud** ‚Üí **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã**
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É VM –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ—ë
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **–ì—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
4. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ Security Group —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:

```
–í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:
- TCP/22 (SSH)    | –ò—Å—Ç–æ—á–Ω–∏–∫: 0.0.0.0/0
- TCP/80 (HTTP)   | –ò—Å—Ç–æ—á–Ω–∏–∫: 0.0.0.0/0  ‚Üê –í–ê–ñ–ù–û!
- TCP/443 (HTTPS) | –ò—Å—Ç–æ—á–Ω–∏–∫: 0.0.0.0/0  ‚Üê –í–ê–ñ–ù–û!

–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:
- –í—Å–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: 0.0.0.0/0
```

### 3. üåê –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü–æ–ª—É—á–∏—Ç–µ IP —Å–µ—Ä–≤–µ—Ä–∞
curl https://ipv4.icanhazip.com

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig +short yourdomain.com A
```

–ï—Å–ª–∏ IP –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –æ–±–Ω–æ–≤–∏—Ç–µ DNS –∑–∞–ø–∏—Å–∏ —É –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞.

### 4. üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π firewall

```bash
# –ï—Å–ª–∏ UFW –∞–∫—Ç–∏–≤–µ–Ω
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo ufw status
```

### 5. ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ù–∞ –∫–∞–∫–∏—Ö –ø–æ—Ä—Ç–∞—Ö —Å–ª—É—à–∞–µ—Ç
sudo netstat -tlnp | grep :80
```

### 6. üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ SSL

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º:

```bash
./scripts/deployment/setup-nginx-yandex.sh yourdomain.com
```

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: DNS –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-60 –º–∏–Ω—É—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `listen 80;` (–Ω–µ `127.0.0.1:80`)

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ Security Groups

**–†–µ—à–µ–Ω–∏–µ:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–∫—Ä–æ–π—Ç–µ TCP/80 –∏ TCP/443 –¥–ª—è 0.0.0.0/0

### –ü—Ä–æ–±–ª–µ–º–∞: Webroot –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**

```bash
sudo mkdir -p /var/www/html/.well-known/acme-challenge
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html
```

## üéØ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –î–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTP
curl -I http://yourdomain.com/

# –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç 200 - –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å SSL!
./scripts/deployment/setup-nginx-yandex.sh yourdomain.com
```

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Yandex Cloud Console](https://console.cloud.yandex.ru/)
- [DNS checker](https://www.whatsmydns.net/)
- [SSL test](https://www.ssllabs.com/ssltest/)
- [Let's Encrypt Community](https://community.letsencrypt.org/)

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./scripts/maintenance/diagnose-connectivity.sh`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo tail -f /var/log/nginx/error.log`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ certbot: `sudo tail -f /var/log/letsencrypt/letsencrypt.log`
